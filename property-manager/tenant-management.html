<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenant Management | Rento</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        .tenant-management-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            margin-bottom: 100px;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .back-btn {
            background: white;
            color: var(--text-gray);
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: #f8fafc;
            color: var(--text-dark);
        }

        .search-filters {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 24px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .search-input {
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.875rem;
            width: 300px;
        }

        .filter-select {
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            font-size: 0.875rem;
            min-width: 150px;
        }

        .tenant-grid {
            display: grid;
            gap: 20px;
        }

        .tenant-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease;
        }

        .tenant-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .tenant-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .tenant-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .tenant-info {
            flex: 1;
        }

        .tenant-name {
            font-size: 1.375rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0 0 8px 0;
        }

        .tenant-property {
            color: var(--text-gray);
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .payment-status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-current {
            background: #dcfce7;
            color: #166534;
        }

        .status-overdue {
            background: #fecaca;
            color: #dc2626;
        }

        .status-upcoming {
            background: #fef3c7;
            color: #d97706;
        }

        .tenant-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 0.75rem;
            color: var(--text-gray);
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.875rem;
        }

        .payment-history {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .payment-history-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .payment-list {
            display: grid;
            gap: 8px;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-gray);
        }

        .payment-amount {
            font-weight: 500;
            color: var(--text-dark);
        }

        .tenant-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: #f8fafc;
            color: var(--text-gray);
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
        }

        .btn-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .btn-warning:hover {
            background: #fde68a;
        }

        .btn-whatsapp {
            background: #25d366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #128c7e;
        }

        .btn-danger {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .btn-danger:hover {
            background: #fecaca;
            color: #b91c1c;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-gray);
        }

        .tenant-bio {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .bio-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .bio-content {
            color: var(--text-gray);
            line-height: 1.5;
            font-size: 0.875rem;
        }

        .full-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .communication-options {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .tenant-management-container {
                padding: 16px;
            }

            .page-header {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }

            .search-filters {
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                width: 100%;
            }

            .tenant-header {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }

            .tenant-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-content">
            <a href="properties.html"><img src="../assets/rento-logo-dark.svg" alt="Rento" class="nav-logo"></a>
            
            <div class="user-menu">
                <div style="background: var(--primary-color); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; cursor: pointer;" onclick="toggleDropdown()" id="userInitials">PM</div>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="profile.html" class="dropdown-item">Profile</a>
                    <a href="#" class="dropdown-item" onclick="switchAccount(event)">Switch Account</a>
                    <a href="#" class="dropdown-item logout-btn" onclick="logout()">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="tenant-management-container">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--text-dark); margin: 0;">Tenant Management</h1>
                <p style="color: var(--text-gray); margin: 8px 0 0 0;">Manage all tenants across your properties</p>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
                <button class="action-btn btn-primary" onclick="openAddTenantModal()" style="padding: 12px 20px;">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clipRule="evenodd"/>
                    </svg>
                    Add Tenant
                </button>
                <a href="property-dashboard.html" class="back-btn" id="backBtn">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd"/>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="search-filters">
            <input type="text" class="search-input" placeholder="Search tenants by name, unit, or property..." id="searchInput" onkeyup="filterTenants()">
            <select class="filter-select" id="propertyFilter" onchange="filterTenants()">
                <option value="">All Properties</option>
                <option value="hillview">Hillview Apartment</option>
                <option value="garden_view">Garden View Apartments</option>
                <option value="sunset">Sunset Heights</option>
            </select>
            <select class="filter-select" id="statusFilter" onchange="filterTenants()">
                <option value="">All Payment Status</option>
                <option value="current">Current</option>
                <option value="overdue">Overdue</option>
                <option value="upcoming">Due Soon</option>
            </select>
        </div>

        <!-- Tenants List -->
        <div class="tenant-grid" id="tenantGrid">
            <!-- Tenants will be loaded here -->
        </div>
    </div>

    <!-- Tenant Details Modal -->
    <div id="tenantDetailsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTenantName">Tenant Details</h2>
                <button class="modal-close" onclick="closeTenantModal()">&times;</button>
            </div>
            
            <div id="modalContent">
                <!-- Tenant details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Tenant Modal -->
    <div id="addTenantModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Tenant</h2>
                <button class="modal-close" onclick="closeAddTenantModal()">&times;</button>
            </div>
            
            <form id="addTenantForm" onsubmit="addNewTenant(event)">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Full Name *</label>
                        <input type="text" id="tenantName" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Email Address *</label>
                        <input type="email" id="tenantEmail" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Phone Number *</label>
                        <input type="tel" id="tenantPhone" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Property</label>
                        <select id="tenantProperty" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem; background: white;">
                            <option value="">Select Property</option>
                            <option value="hillview">Hillview Apartment</option>
                            <option value="garden_view">Garden View Apartments</option>
                            <option value="sunset">Sunset Heights</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Unit *</label>
                        <input type="text" id="tenantUnit" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Monthly Rent (UGX) *</label>
                        <input type="number" id="tenantRent" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Security Deposit (UGX)</label>
                        <input type="number" id="tenantDeposit" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Lease Start Date *</label>
                        <input type="date" id="tenantLeaseStart" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Lease End Date *</label>
                        <input type="date" id="tenantLeaseEnd" required style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                    </div>
                </div>
                
                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Emergency Contact Name</label>
                    <input type="text" id="emergencyName" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem; margin-bottom: 12px;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Emergency Contact Phone</label>
                    <input type="tel" id="emergencyPhone" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem; margin-bottom: 12px;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-dark); margin-bottom: 6px;">Relationship</label>
                    <input type="text" id="emergencyRelationship" style="width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.875rem;">
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="action-btn btn-secondary" onclick="closeAddTenantModal()">
                        Cancel
                    </button>
                    <button type="submit" class="action-btn btn-primary">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clipRule="evenodd"/>
                        </svg>
                        Add Tenant & Send Invitation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/auth.js"></script>
    <script>
        let currentUser = null;
        let allTenants = [
            {
                id: 1,
                name: 'Sarah Johnson',
                email: 'sarah.johnson@email.com',
                phone: '+256 700 123 456',
                avatar: 'SJ',
                property: 'Hillview Apartment',
                propertyId: 'hillview',
                unit: 'Unit A2',
                rentAmount: 1500000,
                securityDeposit: 3000000,
                leaseStart: '2024-01-15',
                leaseEnd: '2024-12-31',
                nextPaymentDue: '2024-11-15',
                paymentStatus: 'current',
                bio: 'Marketing professional working in downtown Kampala. Non-smoker, no pets. Excellent tenant with clean rental history and consistent payment record.',
                emergencyContact: {
                    name: 'John Johnson',
                    relationship: 'Brother',
                    phone: '+256 701 654 321'
                },
                paymentHistory: [
                    { date: '2024-10-15', amount: 1500000, status: 'paid' },
                    { date: '2024-09-15', amount: 1500000, status: 'paid' },
                    { date: '2024-08-15', amount: 1500000, status: 'paid' }
                ]
            },
            {
                id: 2,
                name: 'Michael Okello',
                email: 'm.okello@email.com',
                phone: '+256 772 456 789',
                avatar: 'MO',
                property: 'Garden View Apartments',
                propertyId: 'garden_view',
                unit: 'Unit 3A',
                rentAmount: 1200000,
                securityDeposit: 2400000,
                leaseStart: '2024-03-01',
                leaseEnd: '2025-02-28',
                nextPaymentDue: '2024-10-01',
                paymentStatus: 'overdue',
                bio: 'Software engineer at local tech startup. Quiet tenant who works from home. Has been with us for 8 months with generally good payment record.',
                emergencyContact: {
                    name: 'Grace Okello',
                    relationship: 'Sister',
                    phone: '+256 703 987 654'
                },
                paymentHistory: [
                    { date: '2024-09-01', amount: 1200000, status: 'paid' },
                    { date: '2024-08-01', amount: 1200000, status: 'paid' },
                    { date: '2024-07-01', amount: 1200000, status: 'paid' }
                ]
            },
            {
                id: 3,
                name: 'Agnes Nakato',
                email: 'aggie.nak@email.com',
                phone: '+256 701 654 321',
                avatar: 'AN',
                property: 'Sunset Heights',
                propertyId: 'sunset',
                unit: 'Unit 1A',
                rentAmount: 1800000,
                securityDeposit: 3600000,
                leaseStart: '2023-06-01',
                leaseEnd: '2024-05-31',
                nextPaymentDue: '2024-11-01',
                paymentStatus: 'current',
                bio: 'Bank manager with excellent credit history. Long-term tenant who takes great care of the property. Always pays rent early and maintains excellent communication.',
                emergencyContact: {
                    name: 'Peter Nakato',
                    relationship: 'Husband',
                    phone: '+256 704 123 789'
                },
                paymentHistory: [
                    { date: '2024-10-01', amount: 1800000, status: 'paid' },
                    { date: '2024-09-01', amount: 1800000, status: 'paid' },
                    { date: '2024-08-01', amount: 1800000, status: 'paid' }
                ]
            },
            {
                id: 4,
                name: 'James Mwangi',
                email: 'james.mw@email.com',
                phone: '+256 784 321 654',
                avatar: 'JM',
                property: 'Hillview Apartment',
                propertyId: 'hillview',
                unit: 'Unit 4C',
                rentAmount: 1300000,
                securityDeposit: 2600000,
                leaseStart: '2023-12-01',
                leaseEnd: '2024-11-30',
                nextPaymentDue: '2024-11-20',
                paymentStatus: 'upcoming',
                bio: 'Teacher at international school. Quiet and respectful tenant. Moving out at end of lease to relocate for new job opportunity.',
                emergencyContact: {
                    name: 'Mary Mwangi',
                    relationship: 'Wife',
                    phone: '+256 785 456 123'
                },
                paymentHistory: [
                    { date: '2024-10-01', amount: 1300000, status: 'paid' },
                    { date: '2024-09-01', amount: 1300000, status: 'paid' },
                    { date: '2024-08-01', amount: 1300000, status: 'paid' }
                ]
            },
            {
                id: 5,
                name: 'Ruth Atieno',
                email: 'ruth.atieno@email.com',
                phone: '+256 706 789 012',
                avatar: 'RA',
                property: 'Garden View Apartments',
                propertyId: 'garden_view',
                unit: 'Unit 2B',
                rentAmount: 1400000,
                securityDeposit: 2800000,
                leaseStart: '2024-04-15',
                leaseEnd: '2025-04-14',
                nextPaymentDue: '2024-11-10',
                paymentStatus: 'current',
                bio: 'Nurse at Mulago Hospital. Very responsible tenant who works night shifts. Always communicates any maintenance needs promptly.',
                emergencyContact: {
                    name: 'David Atieno',
                    relationship: 'Brother',
                    phone: '+256 707 234 567'
                },
                paymentHistory: [
                    { date: '2024-10-10', amount: 1400000, status: 'paid' },
                    { date: '2024-09-10', amount: 1400000, status: 'paid' },
                    { date: '2024-08-10', amount: 1400000, status: 'paid' }
                ]
            }
        ];
        
        let filteredTenants = [...allTenants];

        document.addEventListener('DOMContentLoaded', function() {
            currentUser = AuthManager.getCurrentUser() || {
                email: 'test@propertymanager.com',
                name: 'Property Manager',
                role: 'property_manager'
            };

            // Update user initials
            if (currentUser.name) {
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.getElementById('userInitials').textContent = initials;
            }

            loadPropertyData();
            renderTenants();
        });

        function loadPropertyData() {
            const urlParams = new URLSearchParams(window.location.search);
            const propertyId = urlParams.get('id') || localStorage.getItem('selectedPropertyId');
            
            if (!propertyId) {
                // If no specific property, show all tenants
                document.getElementById('backBtn').href = 'properties.html';
            } else {
                // Update back button
                document.getElementById('backBtn').href = `property-dashboard.html?id=${propertyId}`;
            }
        }

        function renderTenants() {
            const grid = document.getElementById('tenantGrid');
            grid.innerHTML = filteredTenants.map(tenant => `
                <div class="tenant-card">
                    <div class="tenant-header">
                        <div class="tenant-avatar">${tenant.avatar}</div>
                        <div class="tenant-info">
                            <h2 class="tenant-name">${tenant.name}</h2>
                            <div class="tenant-property">
                                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10.707 2.293a1 1 0 00-1.414 0l-9 9a1 1 0 001.414 1.414L2 12.414V17a1 1 0 001 1h3a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1h3a1 1 0 001-1v-4.586l.293.293a1 1 0 001.414-1.414l-9-9z"/>
                                </svg>
                                ${tenant.property} - ${tenant.unit}
                            </div>
                            <span class="payment-status-badge status-${tenant.paymentStatus}">
                                ${getPaymentStatusText(tenant.paymentStatus)}
                            </span>
                        </div>
                    </div>

                    <div class="tenant-details">
                        <div class="detail-item">
                            <div class="detail-label">Monthly Rent</div>
                            <div class="detail-value">UGX ${tenant.rentAmount.toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Next Payment Due</div>
                            <div class="detail-value">${formatDate(tenant.nextPaymentDue)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Lease Period</div>
                            <div class="detail-value">${formatDate(tenant.leaseStart)} - ${formatDate(tenant.leaseEnd)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Contact</div>
                            <div class="detail-value">${tenant.phone}</div>
                        </div>
                    </div>

                    <div class="payment-history">
                        <div class="payment-history-title">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"/>
                            </svg>
                            Recent Payments
                        </div>
                        <div class="payment-list">
                            ${tenant.paymentHistory.slice(0, 3).map(payment => `
                                <div class="payment-item">
                                    <span>${formatDate(payment.date)}</span>
                                    <span class="payment-amount">UGX ${payment.amount.toLocaleString()}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="tenant-actions">
                        <button class="action-btn btn-primary" onclick="viewTenantDetails(${tenant.id})">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                <path fillRule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clipRule="evenodd"/>
                            </svg>
                            View Details
                        </button>
                        <button class="action-btn btn-secondary" onclick="sendEmail('${tenant.email}')">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                            </svg>
                            Email
                        </button>
                        <button class="action-btn btn-whatsapp" onclick="sendWhatsApp('${tenant.phone}')">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                            </svg>
                            WhatsApp
                        </button>
                        ${tenant.paymentStatus === 'overdue' ? `
                            <button class="action-btn btn-warning" onclick="sendReminder(${tenant.id})">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd"/>
                                </svg>
                                Send Reminder
                            </button>
                        ` : ''}
                        <button class="action-btn btn-danger" onclick="deleteTenant(${tenant.id})">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd"/>
                            </svg>
                            Remove
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterTenants() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const propertyFilter = document.getElementById('propertyFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredTenants = allTenants.filter(tenant => {
                const matchesSearch = tenant.name.toLowerCase().includes(searchTerm) ||
                                    tenant.property.toLowerCase().includes(searchTerm) ||
                                    tenant.unit.toLowerCase().includes(searchTerm);
                
                const matchesProperty = !propertyFilter || tenant.propertyId === propertyFilter;
                const matchesStatus = !statusFilter || tenant.paymentStatus === statusFilter;

                return matchesSearch && matchesProperty && matchesStatus;
            });

            renderTenants();
        }

        function viewTenantDetails(tenantId) {
            const tenant = allTenants.find(t => t.id === tenantId);
            if (!tenant) return;

            document.getElementById('modalTenantName').textContent = tenant.name;
            document.getElementById('modalContent').innerHTML = `
                <div class="tenant-bio">
                    <div class="bio-title">About ${tenant.name}</div>
                    <div class="bio-content">${tenant.bio}</div>
                </div>

                <div class="full-details-grid">
                    <div class="detail-item">
                        <div class="detail-label">Email</div>
                        <div class="detail-value">${tenant.email}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Phone</div>
                        <div class="detail-value">${tenant.phone}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Property</div>
                        <div class="detail-value">${tenant.property}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Unit</div>
                        <div class="detail-value">${tenant.unit}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Monthly Rent</div>
                        <div class="detail-value">UGX ${tenant.rentAmount.toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Security Deposit</div>
                        <div class="detail-value">UGX ${tenant.securityDeposit.toLocaleString()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Lease Start</div>
                        <div class="detail-value">${formatDate(tenant.leaseStart)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Lease End</div>
                        <div class="detail-value">${formatDate(tenant.leaseEnd)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Emergency Contact</div>
                        <div class="detail-value">${tenant.emergencyContact.name} (${tenant.emergencyContact.relationship})<br>${tenant.emergencyContact.phone}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Payment Status</div>
                        <div class="detail-value">
                            <span class="payment-status-badge status-${tenant.paymentStatus}">
                                ${getPaymentStatusText(tenant.paymentStatus)}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="payment-history" style="margin-top: 24px;">
                    <div class="payment-history-title">Complete Payment History</div>
                    <div class="payment-list">
                        ${tenant.paymentHistory.map(payment => `
                            <div class="payment-item">
                                <span>${formatDate(payment.date)}</span>
                                <span class="payment-amount">UGX ${payment.amount.toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="communication-options">
                    <button class="action-btn btn-secondary" onclick="sendEmail('${tenant.email}')">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        Send Email
                    </button>
                    <button class="action-btn btn-whatsapp" onclick="sendWhatsApp('${tenant.phone}')">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                        </svg>
                        WhatsApp
                    </button>
                    ${tenant.paymentStatus === 'overdue' ? `
                        <button class="action-btn btn-warning" onclick="sendReminder(${tenant.id})">
                            Send Payment Reminder
                        </button>
                    ` : ''}
                </div>
            `;

            document.getElementById('tenantDetailsModal').style.display = 'flex';
        }

        function closeTenantModal() {
            document.getElementById('tenantDetailsModal').style.display = 'none';
        }

        function sendEmail(email) {
            window.open(`mailto:${email}`, '_blank');
            showNotification(`Opening email client to send message to ${email}`, 'info');
        }

        function sendWhatsApp(phone) {
            const cleanPhone = phone.replace(/\D/g, '');
            window.open(`https://wa.me/${cleanPhone}`, '_blank');
            showNotification(`Opening WhatsApp to send message to ${phone}`, 'info');
        }

        function sendReminder(tenantId) {
            const tenant = allTenants.find(t => t.id === tenantId);
            if (tenant) {
                showNotification(`Payment reminder sent to ${tenant.name}`, 'success');
                // In a real app, this would send an actual reminder
            }
        }

        function getPaymentStatusText(status) {
            switch (status) {
                case 'current': return 'Current';
                case 'overdue': return 'Overdue';
                case 'upcoming': return 'Due Soon';
                default: return status;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('show');
        }

        async function logout() {
            await AuthManager.signOut();
        }

        // Event listeners
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('dropdownMenu').classList.remove('show');
            }
        });

        document.getElementById('tenantDetailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTenantModal();
            }
        });

        document.getElementById('addTenantModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddTenantModal();
            }
        });

        function openAddTenantModal() {
            document.getElementById('addTenantModal').style.display = 'flex';
        }

        function closeAddTenantModal() {
            document.getElementById('addTenantModal').style.display = 'none';
            document.getElementById('addTenantForm').reset();
        }

        function addNewTenant(event) {
            event.preventDefault();
            
            // Get form values
            const formData = {
                name: document.getElementById('tenantName').value,
                email: document.getElementById('tenantEmail').value,
                phone: document.getElementById('tenantPhone').value,
                propertyId: document.getElementById('tenantProperty').value,
                unit: document.getElementById('tenantUnit').value,
                rentAmount: parseInt(document.getElementById('tenantRent').value),
                securityDeposit: parseInt(document.getElementById('tenantDeposit').value) || 0,
                leaseStart: document.getElementById('tenantLeaseStart').value,
                leaseEnd: document.getElementById('tenantLeaseEnd').value,
                emergencyContact: {
                    name: document.getElementById('emergencyName').value || 'N/A',
                    phone: document.getElementById('emergencyPhone').value || 'N/A',
                    relationship: document.getElementById('emergencyRelationship').value || 'N/A'
                }
            };

            // Create new tenant object
            const newTenant = {
                id: Date.now(), // Simple ID generation
                name: formData.name,
                email: formData.email,
                phone: formData.phone,
                avatar: formData.name.split(' ').map(n => n[0]).join('').toUpperCase(),
                property: getPropertyName(formData.propertyId),
                propertyId: formData.propertyId,
                unit: formData.unit,
                rentAmount: formData.rentAmount,
                securityDeposit: formData.securityDeposit,
                leaseStart: formData.leaseStart,
                leaseEnd: formData.leaseEnd,
                nextPaymentDue: getNextPaymentDue(formData.leaseStart),
                paymentStatus: 'current',
                bio: `New tenant added to ${getPropertyName(formData.propertyId)}. Welcome to our property!`,
                emergencyContact: formData.emergencyContact,
                paymentHistory: []
            };

            // Add to tenants array
            allTenants.push(newTenant);
            filteredTenants = [...allTenants];
            
            // Re-render the tenant list
            renderTenants();
            
            // Close modal and show success message
            closeAddTenantModal();
            
            // Simulate sending invitation email
            showNotification(`Tenant added successfully! Invitation email sent to ${formData.email}`, 'success');
            
            // In a real app, this would send an actual email invitation
            setTimeout(() => {
                showNotification(`${formData.name} can now download the Rento app and access their tenant portal`, 'info');
            }, 2000);
        }

        function deleteTenant(tenantId) {
            const tenant = allTenants.find(t => t.id === tenantId);
            if (!tenant) return;
            
            if (confirm(`Are you sure you want to remove ${tenant.name} from the system? This action cannot be undone.`)) {
                // Remove from arrays
                allTenants = allTenants.filter(t => t.id !== tenantId);
                filteredTenants = filteredTenants.filter(t => t.id !== tenantId);
                
                // Re-render the tenant list
                renderTenants();
                
                showNotification(`${tenant.name} has been removed from the system`, 'success');
            }
        }

        function getPropertyName(propertyId) {
            const propertyMap = {
                'hillview': 'Hillview Apartment',
                'garden_view': 'Garden View Apartments',
                'sunset': 'Sunset Heights'
            };
            return propertyMap[propertyId] || 'Unknown Property';
        }

        function getNextPaymentDue(leaseStart) {
            const startDate = new Date(leaseStart);
            const currentDate = new Date();
            
            // Calculate next payment date (assuming monthly payments)
            const nextPayment = new Date(startDate);
            nextPayment.setMonth(currentDate.getMonth() + 1);
            nextPayment.setDate(startDate.getDate());
            
            return nextPayment.toISOString().split('T')[0];
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'info' ? '#3b82f6' : type === 'error' ? '#ef4444' : '#10b981'};
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                font-weight: 500;
                max-width: 400px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>